{% include head.html %}

<!-- custom slide styles -->
<link rel="stylesheet" type="text/css" href="/css/slides/typo.css" />
<link rel="stylesheet" type="text/css" href="/css/slides/layout.css" />
<link rel="stylesheet" type="text/css" href="/css/slides/nord.css" />
<link rel="stylesheet" type="text/css" href="/css/slides/remark_it_style.css" />
<link rel="stylesheet" type="text/css" href="/css/slides/spaces.css" />
<link rel="stylesheet" type="text/css" href="/css/slides/open-color.css" />
<link rel="stylesheet" type="text/css" href="/css/slides/text-rect.css" />

<!-- mathjax -->
{% if page.mathjax %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true
        }
    });
</script>
{% endif %}

<!-- remark -->
<script src="/js/remark.min.js"></script>

<!-- mermaid -->
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

    mermaid.initialize({
        startOnLoad: false,
        theme: "forest",
        gantt: {
            fontSize: 26,
            barHeight: 30,
            useMaxWidth: false,
        },
    });

    async function renderMermaidDiagrams() {
        const mermaidCmps = document.querySelectorAll(".mermaid");

        for (let i = 0; i < mermaidCmps.length; i++) {
            const mermaidCmp = mermaidCmps[i];

            let graphDefinition = "";
            const pCmps = mermaidCmp.querySelectorAll("pre");
            for (const pCmp of pCmps) {
                graphDefinition += pCmp.textContent;
            }

            if (!graphDefinition.trim()) continue;

            try {
                const { svg } = await mermaid.render(`graphDiv${i}`, graphDefinition);
                mermaidCmp.innerHTML = svg;
            } catch (error) {
                console.error(`Error rendering mermaid diagram ${i}:`, error);
                console.error('Graph definition:', graphDefinition);
            }
        }
    }

    window.renderMermaidDiagrams = renderMermaidDiagrams;
</script>

<script>

    let slideshow = {}; // useful for decktape export
    document.addEventListener('DOMContentLoaded', function () {
        slideshow = remark.create({
            source: `{{ content }}`,
            countIncrementalSlides: false,
        });

        slideshow.on('afterShowSlide', function (slide) {
            if (window.renderMermaidDiagrams) {
                window.renderMermaidDiagrams();
            }
        });

        if (window.renderMermaidDiagrams) {
            window.renderMermaidDiagrams();
        }
    });
</script>